<!-- test.html -->
<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>测试页面</title>
	</head>
	<body>
		<h1>这是 test.html 页面</h1>
		<button onclick="signSuccess()">点击发送消息</button>
  <script type="text/javascript" src="https://gitcode.com/dcloud/uni-app/tree/dev/dist/uni.webview.1.5.6.js"></script>
		<script>
			function signSuccess() {
				console.log("test.html: signSuccess 被调用");

				// 优先检测 uni-app web-view 环境
				if (typeof uni !== 'undefined' && uni.postMessage) {
					console.log("uni-app web-view 环境");
					// 使用 uni.postMessage 发送消息给 uni-app
					uni.postMessage({
						data: {
							action: 'signSuccess',
							payload: {
								message: '签署成功',
								timestamp: new Date().getTime()
							}
						}
					});
				} else if (/android/i.test(navigator.userAgent)) {
					console.log("android");
					if (window.android && window.android.signSuccess) {
						window.android.signSuccess('authSuccess');
					}
				} else if (/ipad|iphone|iPod|iOS/i.test(navigator.userAgent)) {
					console.log("ios");
					if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.FLJMessage) {
						window.webkit.messageHandlers.FLJMessage.postMessage({
							"auth": "success"
						});
					}
				} else {
					console.log("web");
					// 普通浏览器环境，使用 postMessage
					if (window.parent) {
						window.parent.postMessage({
							action: 'signSuccess',
							payload: {
								message: '签署成功'
							}
						}, '*');
					}
				}
			}
		</script>
	</body>
</html>
